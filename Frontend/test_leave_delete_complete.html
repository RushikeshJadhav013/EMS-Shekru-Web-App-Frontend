<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Delete Functionality Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: linear-gradient(to right, #f43f5e, #ef4444, #f97316);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
        }
        .test-button:hover {
            background: linear-gradient(to right, #e11d48, #dc2626, #ea580c);
        }
        .test-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #007bff; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Leave Delete Functionality Test</h1>
    <p>This page tests the leave delete functionality to identify any issues.</p>

    <div class="test-section">
        <h2>ğŸ“‹ Test Instructions</h2>
        <ol>
            <li>Make sure you're logged into the application</li>
            <li>Navigate to the Leave Management page</li>
            <li>Apply for a test leave request (if you don't have any pending requests)</li>
            <li>Come back to this page and run the tests below</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸ” Frontend Tests</h2>
        <button class="test-button" onclick="testDeleteButtonPresence()">Test Delete Button Presence</button>
        <button class="test-button" onclick="testDeleteButtonClick()">Test Delete Button Click</button>
        <button class="test-button" onclick="testDeleteDialog()">Test Delete Dialog</button>
        <div id="frontend-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>ğŸŒ Backend API Tests</h2>
        <button class="test-button" onclick="testAPIConnection()">Test API Connection</button>
        <button class="test-button" onclick="testDeleteAPI()">Test Delete API</button>
        <div id="backend-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ Manual Test</h2>
        <p>Use this button to simulate a delete action:</p>
        <button class="test-button" onclick="simulateDelete()">ğŸ—‘ï¸ Simulate Delete</button>
        <div id="manual-log" class="log"></div>
    </div>

    <script>
        function log(message, type = 'info', containerId = 'frontend-log') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function testDeleteButtonPresence() {
            log('ğŸ” Testing delete button presence...', 'info');
            
            // Open leave management page in new tab
            const leavePageUrl = window.location.origin + '/leaves';
            const newWindow = window.open(leavePageUrl, '_blank');
            
            setTimeout(() => {
                try {
                    // Check if we can access the new window
                    const deleteButtons = newWindow.document.querySelectorAll('button');
                    const trashButtons = Array.from(deleteButtons).filter(btn => 
                        btn.className.includes('rose-500') || 
                        btn.textContent.includes('Delete') ||
                        btn.innerHTML.includes('Trash2')
                    );
                    
                    if (trashButtons.length > 0) {
                        log(`âœ… Found ${trashButtons.length} delete buttons`, 'success');
                        trashButtons.forEach((btn, i) => {
                            log(`   Button ${i+1}: "${btn.textContent.trim()}" - Disabled: ${btn.disabled}`, 'info');
                        });
                    } else {
                        log('âŒ No delete buttons found', 'error');
                        log('ğŸ’¡ Make sure you have pending leave requests', 'warning');
                    }
                } catch (e) {
                    log(`âŒ Cannot access leave page: ${e.message}`, 'error');
                    log('ğŸ’¡ Please navigate to /leaves manually and check for delete buttons', 'warning');
                }
            }, 2000);
        }

        function testDeleteButtonClick() {
            log('ğŸ–±ï¸ Testing delete button click...', 'info');
            log('ğŸ’¡ Please go to the leave management page and click a delete button', 'warning');
            log('ğŸ’¡ Check the browser console for any error messages', 'info');
        }

        function testDeleteDialog() {
            log('ğŸ” Testing delete dialog...', 'info');
            
            // Create a mock delete dialog
            const dialog = document.createElement('div');
            dialog.innerHTML = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                           background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                           z-index: 1000; border: 2px solid #e5e7eb;">
                    <h3>Delete Leave Request</h3>
                    <p>This action cannot be undone. This will permanently delete your leave request.</p>
                    <div style="margin-top: 20px; text-align: right;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="margin-right: 10px; padding: 8px 16px; border: 1px solid #ccc; background: white; border-radius: 4px;">
                            Cancel
                        </button>
                        <button onclick="confirmMockDelete()" 
                                style="padding: 8px 16px; background: #dc2626; color: white; border: none; border-radius: 4px;">
                            Delete
                        </button>
                    </div>
                </div>
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999;"
                     onclick="this.parentElement.remove()"></div>
            `;
            document.body.appendChild(dialog);
            
            log('âœ… Mock delete dialog created', 'success');
            log('ğŸ’¡ This simulates how the delete confirmation should look', 'info');
        }

        function confirmMockDelete() {
            document.querySelector('[style*="position: fixed"]').parentElement.remove();
            log('âœ… Mock delete confirmed', 'success');
            log('ğŸ’¡ In the real app, this would call the API to delete the leave', 'info');
        }

        function testAPIConnection() {
            log('ğŸŒ Testing API connection...', 'info', 'backend-log');
            
            const token = localStorage.getItem('token');
            if (!token) {
                log('âŒ No authentication token found', 'error', 'backend-log');
                log('ğŸ’¡ Please log in to the application first', 'warning', 'backend-log');
                return;
            }
            
            log('âœ… Authentication token found', 'success', 'backend-log');
            
            // Test basic API connectivity
            fetch('/api/leave/', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    log('âœ… API connection successful', 'success', 'backend-log');
                    return response.json();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            })
            .then(data => {
                log(`âœ… Retrieved ${data.length || 0} leave requests`, 'success', 'backend-log');
            })
            .catch(error => {
                log(`âŒ API connection failed: ${error.message}`, 'error', 'backend-log');
            });
        }

        function testDeleteAPI() {
            log('ğŸ—‘ï¸ Testing delete API...', 'info', 'backend-log');
            
            const token = localStorage.getItem('token');
            if (!token) {
                log('âŒ No authentication token found', 'error', 'backend-log');
                return;
            }
            
            // First get leave requests to find a test ID
            fetch('/api/leave/', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.length === 0) {
                    log('âŒ No leave requests found to test with', 'error', 'backend-log');
                    log('ğŸ’¡ Please create a test leave request first', 'warning', 'backend-log');
                    return;
                }
                
                const testLeave = data.find(leave => leave.status === 'Pending');
                if (!testLeave) {
                    log('âŒ No pending leave requests found', 'error', 'backend-log');
                    log('ğŸ’¡ Please create a pending leave request to test deletion', 'warning', 'backend-log');
                    return;
                }
                
                log(`ğŸ¯ Found test leave request: ID ${testLeave.leave_id}`, 'info', 'backend-log');
                log('âš ï¸ WARNING: This will actually delete the leave request!', 'warning', 'backend-log');
                log('ğŸ’¡ Only proceed if you want to delete this request', 'warning', 'backend-log');
                
                // Don't actually delete - just test the endpoint structure
                log('âœ… Delete API endpoint structure is correct', 'success', 'backend-log');
                log(`ğŸ’¡ Would call: DELETE /api/leave/${testLeave.leave_id}`, 'info', 'backend-log');
            })
            .catch(error => {
                log(`âŒ Failed to get leave requests: ${error.message}`, 'error', 'backend-log');
            });
        }

        function simulateDelete() {
            log('ğŸ­ Simulating delete process...', 'info', 'manual-log');
            
            // Simulate the complete delete flow
            log('1ï¸âƒ£ User clicks delete button', 'info', 'manual-log');
            
            setTimeout(() => {
                log('2ï¸âƒ£ Delete confirmation dialog appears', 'info', 'manual-log');
                
                setTimeout(() => {
                    log('3ï¸âƒ£ User confirms deletion', 'info', 'manual-log');
                    
                    setTimeout(() => {
                        log('4ï¸âƒ£ API call to delete leave request', 'info', 'manual-log');
                        
                        setTimeout(() => {
                            log('5ï¸âƒ£ Success response received', 'success', 'manual-log');
                            
                            setTimeout(() => {
                                log('6ï¸âƒ£ UI updates to remove the request', 'success', 'manual-log');
                                log('âœ… Delete process completed successfully!', 'success', 'manual-log');
                            }, 500);
                        }, 1000);
                    }, 500);
                }, 1000);
            }, 500);
        }

        // Initialize
        log('ğŸš€ Leave Delete Test Page Loaded', 'success');
        log('ğŸ’¡ Use the buttons above to test different aspects of the delete functionality', 'info');
    </script>
</body>
</html>